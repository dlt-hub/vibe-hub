resources:
- name: items
  endpoint:
    path: /search
    method: GET
    data_selector: item_collection
    params:
      collections:
      - sentinel-2-l2a
      datetime: 2020-03-01/2020-06-01
- name: earthsearch:payload_id
  endpoint:
    path: /earthsearch/payload_id
    method: GET
- name: view:sun_azimuth
  endpoint:
    path: /view/sun_azimuth
    method: GET
- name: s2:water_percentage
  endpoint:
    path: /s2/water_percentage
    method: GET
- name: s2:sequence
  endpoint:
    path: /s2/sequence
    method: GET
- name: constellation
  endpoint:
    path: /constellation
    method: GET
- name: mgrs:grid_square
  endpoint:
    path: /mgrs/grid_square
    method: GET
- name: s2:high_proba_clouds_percentage
  endpoint:
    path: /s2/high_proba_clouds_percentage
    method: GET
- name: earthsearch:s3_path
  endpoint:
    path: /earthsearch/s3_path
    method: GET
- name: s2:vegetation_percentage
  endpoint:
    path: /s2/vegetation_percentage
    method: GET
- name: s2:granule_id
  endpoint:
    path: /s2/granule_id
    method: GET
- name: s2:medium_proba_clouds_percentage
  endpoint:
    path: /services/data/vXX.X/sobjects/medium_proba_clouds_percentage
    method: GET
    data_selector: records
- name: eo:cloud_cover
  endpoint:
    path: /services/data/vXX.X/sobjects/cloud_cover
    method: GET
    data_selector: records
- name: s2:datastrip_id
  endpoint:
    path: /services/data/vXX.X/sobjects/datastrip_id
    method: GET
    data_selector: records
- name: created
  endpoint:
    path: /services/data/vXX.X/sobjects/created
    method: GET
    data_selector: records
- name: platform
  endpoint:
    path: /services/data/vXX.X/sobjects/platform
    method: GET
    data_selector: records
- name: s2:not_vegetated_percentage
  endpoint:
    path: /s2/not_vegetated_percentage
    method: GET
    data_selector: records
- name: s2:unclassified_percentage
  endpoint:
    path: /s2/unclassified_percentage
    method: GET
    data_selector: records
- name: s2:degraded_msi_data_percentage
  endpoint:
    path: /s2/degraded_msi_data_percentage
    method: GET
    data_selector: records
- name: view:sun_elevation
  endpoint:
    path: /view/sun_elevation
    method: GET
    data_selector: records
- name: s2:cloud_shadow_percentage
  endpoint:
    path: /s2/cloud_shadow_percentage
    method: GET
    data_selector: records
- name: s2:thin_cirrus_percentage
  endpoint:
    path: /s2/thin_cirrus_percentage
    method: GET
    data_selector: records
- name: s2:snow_ice_percentage
  endpoint:
    path: /s2/snow_ice_percentage
    method: GET
    data_selector: records
- name: updated
  endpoint:
    path: /updated
    method: GET
    data_selector: records
- name: processing:software
  endpoint:
    path: /processing/software
    method: GET
    data_selector: records
- name: mgrs:latitude_band
  endpoint:
    path: /mgrs/latitude_band
    method: GET
    data_selector: records
- name: s2:datatake_id
  endpoint:
    path: /s2/datatake_id
    method: GET
    data_selector: records
- name: s2:reflectance_conversion_factor
  endpoint:
    path: /s2/reflectance_conversion_factor
    method: GET
    data_selector: records
- name: saturated_defective_pixel_percentage
  endpoint:
    path: /services/data/vXX.X/sobjects/saturated_defective_pixel_percentage
    method: GET
    data_selector: records
    params: {}
- name: generation_time
  endpoint:
    path: /services/data/vXX.X/sobjects/generation_time
    method: GET
    data_selector: records
    params: {}
- name: stackstac
  endpoint:
    path: /stackstac
    method: GET
- name: stack
  endpoint:
    path: /services/data/vXX.X/sobjects/Stack
    method: GET
    data_selector: records
    params:
      resolution: 100
      bounds_latlon: (-106.2, 35.6, -105.6, 36)
      resampling: Resampling.bilinear
- name: sun_azimuth
  endpoint:
    path: /services/data/vXX.X/sobjects/SunAzimuth
    method: GET
    data_selector: records
    params: {}
- name: granule_id
  endpoint:
    path: /services/data/vXX.X/sobjects/GranuleId
    method: GET
    data_selector: records
    params: {}
- name: latitude_band
  endpoint:
    path: /services/data/vXX.X/sobjects/LatitudeBand
    method: GET
    data_selector: records
    params: {}
- name: dark_features_percentage
  endpoint:
    path: /services/data/vXX.X/sobjects/DarkFeaturesPercentage
    method: GET
    data_selector: records
    params: {}
- name: datatake_id
  endpoint:
    path: /s2/datatake_id
    method: GET
    data_selector: records
    params: {}
- name: instruments
  endpoint:
    path: /s2/instruments
    method: GET
    data_selector: records
    params: {}
- name: nodata_pixel_percentage
  endpoint:
    path: /s2/nodata_pixel_percentage
    method: GET
    data_selector: records
    params: {}
- name: reflectance_conversion_factor
  endpoint:
    path: /s2/reflectance_conversion_factor
    method: GET
    data_selector: records
    params: {}
- name: high_proba_clouds_percentage
  endpoint:
    path: /high_proba_clouds_percentage
    method: GET
    data_selector: records
- name: grid_square
  endpoint:
    path: /grid_square
    method: GET
    data_selector: records
- name: grid_code
  endpoint:
    path: /grid_code
    method: GET
    data_selector: records
- name: s3_path
  endpoint:
    path: /sentinel-cogs/sentinel-s2-l2a-cogs
    method: GET
    data_selector: records
- name: medium_proba_clouds_percentage
  endpoint:
    path: /clouds/percentage
    method: GET
    data_selector: records
- name: cloud_shadow_percentage
  endpoint:
    path: /cloud/shadow/percentage
    method: GET
    data_selector: records
- name: vegetation_percentage
  endpoint:
    path: /vegetation/percentage
    method: GET
    data_selector: records
- name: water_percentage
  endpoint:
    path: /water/percentage
    method: GET
    data_selector: records
- name: s2:product_type
  endpoint:
    path: /path/to/s2/product_type
    method: GET
    data_selector: data
    params: {}
- name: s2:saturated_defective_pixel_percentage
  endpoint:
    path: /path/to/s2/saturated_defective_pixel_percentage
    method: GET
    data_selector: data
    params: {}
- name: s2:datastrip_id
  endpoint:
    path: /path/to/s2/datastrip_id
    method: GET
    data_selector: data
    params: {}
- name: s2:thin_cirrus_percentage
  endpoint:
    path: /path/to/s2/thin_cirrus_percentage
    method: GET
    data_selector: data
    params: {}
- name: view:sun_elevation
  endpoint:
    path: /path/to/view/sun_elevation
    method: GET
    data_selector: data
    params: {}
- name: snow_ice_percentage
  endpoint:
    path: /api/snow_ice_percentage
    method: GET
    data_selector: records
    params: {}
- name: datatake_type
  endpoint:
    path: /api/datatake_type
    method: GET
    data_selector: records
    params: {}
- name: platform
  endpoint:
    path: /api/platform
    method: GET
    data_selector: records
    params: {}
- name: created
  endpoint:
    path: /api/created
    method: GET
    data_selector: records
    params: {}
- name: bands
  endpoint:
    path: /bands
    method: GET
    data_selector: bands
- name: monthly_rgb
  endpoint:
    path: /path/to/monthly_rgb
    method: GET
    data_selector: data
    params: {}
- name: stack
  endpoint:
    path: /stack
    method: GET
    data_selector: data
    params: {}
- name: cloud_cover_land
  endpoint:
    path: /cloud_cover_land
    method: GET
- name: scene_id
  endpoint:
    path: /scene_id
    method: GET
- name: wrs_path
  endpoint:
    path: /wrs_path
    method: GET
- name: band
  endpoint:
    path: /bands
    method: GET
    data_selector: bands
- name: indexes
  endpoint:
    path: /indexes
    method: GET
    data_selector: indexes
- name: attributes
  endpoint:
    path: /attributes
    method: GET
    data_selector: attributes
- name: stack
  endpoint:
    path: /data/stack
    method: GET
    data_selector: records
- name: band
  endpoint:
    path: /band
    method: GET
    data_selector: records
- name: time
  endpoint:
    path: /time
    method: GET
    data_selector: records
- name: x
  endpoint:
    path: /x
    method: GET
    data_selector: records
- name: y
  endpoint:
    path: /y
    method: GET
    data_selector: records
- name: stackstac
  endpoint:
    path: /stackstac
    method: GET
    data_selector: data
    params: {}
- name: stac_items
  endpoint:
    path: /search
    method: GET
    data_selector: item_collection
    params:
      collections: sentinel-2-l2a
      datetime: 2020-04-01/2020-04-15
- name: RGB Data
  endpoint:
    path: /path/to/rgb_data
    method: GET
    data_selector: data
    params: {}
- name: granule
  endpoint:
    path: /granules
    method: GET
    data_selector: records
- name: s2_data
  endpoint:
    path: /s2/data
    method: GET
    data_selector: data
    params: {}
- name: ndvi
  endpoint:
    path: /stackstac/show
    method: GET
    data_selector: records
- name: anomaly
  endpoint:
    path: /stackstac/show
    method: GET
    data_selector: records
- name: show
  endpoint:
    path: /stackstac/show
    method: POST
    data_selector: map
    params: {}
- name: add_to_map
  endpoint:
    path: /stackstac.add_to_map
    method: GET
    data_selector: array
    params: {}
- name: reproject_array
  endpoint:
    path: /stackstac/reproject_array
    method: GET
    data_selector: DataArray
    params: {}
- name: array_bounds
  endpoint:
    path: /array_bounds
    method: GET
    data_selector: bounds
    params: {}
- name: array_epsg
  endpoint:
    path: /stackstac/array_epsg
    method: GET
    data_selector: EPSG code
- name: LayeredEnv
  endpoint:
    path: /stackstac/rio_env/LayeredEnv
    method: GET
    data_selector: attributes
    params: {}
- name: AutoParallelRioReader
  endpoint:
    path: /stackstac/rio_reader/AutoParallelRioReader
    method: GET
    data_selector: dataset
- name: SingleThreadedRioDataset
  endpoint:
    path: /stackstac/rio_reader/SingleThreadedRioDataset
    method: GET
notes:
- Uses EPSG:32613 for coordinate reference system.
- Resolution is 10.0 meters.
- Fetching lower-resolution data is very efficient and requires processing an order
  of magnitude less data.
- Uses EPSG:32613 for spatial reference
- Uses 8 Coiled workers (2 CPU, 8 GiB memory each) for processing.
- Processed ~10 GB of data into median composites.
- Planetary Computer is Microsoft’s open Earth data initiative. It’s free for anyone
  to use, though you have to sign your requests with the planetary_computer package
  to prevent abuse.
- Load and sign all the STAC items with a token from Planetary Computer. Without this,
  loading the data will fail.
- Coiled doesn't yet support Azure's West Europe region, so instead we'll run on a
  nearby AWS data center in Frankfurt
- Use the bit values of the Landsat-8 QA band to mask out bad pixels.
- The Landsat-8 scenes appear to typically be 5-15 days apart.
- Uses Landsat 8 data with a processing level of L2SP
- Uses dask to render GIFs on the cluster.
- This functionality is still very much proof-of-concept, and there’s a lot to be
  improved in the future.
- Resolution doesn’t change as you zoom in or out.
- Uses OAuth2 with refresh token
- No authentication required for this API.
- Calculating 2nd and 98th percentile of the entire array can be expensive.
- Don’t be scared of all the parameters!
- Though there are lots of options, you can leave nearly all of them as their defaults.
- This method is very slow on large arrays due to inefficiencies in generating the
  dask graphs.
- Additionally, all spatial chunking is lost.
errors:
- 'ValueError: If the DataArray has no spec attribute.'
- 'ValueError: If the DataArray is missing the x or y coordinates.'
- 'ValueError: If x or y coordinates are not monotonic.'
- 'ValueError: If to_epsg is given, and the CRS of the xarray.DataArray cannot be
  determined.'
- 'ValueError: If the DataArray has no epsg coordinate, and default is not given'
auth_info:
  mentioned_objects:
  - RasterSpec
  - OauthToken
client:
  base_url: https://earth-search.aws.element84.com/v1
source_metadata: null
