resources:
- name: vm_instance
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
- name: list_vm_instances
  endpoint:
    path: /api/v1/vm
    method: GET
    data_selector: body
- name: update_instance
  endpoint:
    path: /api/v1/vm
    method: PUT
    data_selector: body
- name: terminate_instance
  endpoint:
    path: /api/v1/vm
    method: DELETE
    data_selector: body
- name: vm
  endpoint:
    path: /vm
    method: GET
    data_selector: body
- name: node
  endpoint:
    path: /node
    method: GET
    data_selector: body
- name: vm_instance
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
    params: {}
- name: update_instance
  endpoint:
    path: /api/v1/vm
    method: PUT
    data_selector: body
    params: {}
- name: terminate_instance
  endpoint:
    path: /api/v1/vm
    method: DELETE
    data_selector: body
    params: {}
- name: list_instances
  endpoint:
    path: /api/v1/vm
    method: GET
    data_selector: body
    params: {}
- name: vm
  endpoint:
    path: /vm
    method: GET
    data_selector: body
- name: node
  endpoint:
    path: /node
    method: GET
    data_selector: body
- name: list_templates
  endpoint:
    path: /api/v1/registry/vm
    method: GET
    data_selector: body
    params: {}
- name: delete_node
  endpoint:
    path: /api/v1/node
    method: DELETE
    data_selector: status
    params:
      node_id: f8707005-4630-4c9c-8403-c9c5964097f6
- name: node
  endpoint:
    path: /api/v1/node
    method: GET
    data_selector: body
    params: {}
- name: template
  endpoint:
    path: /api/v1/registry/vm
    method: GET
    data_selector: body
    params: {}
- name: delete_template
  endpoint:
    path: /api/v1/registry/vm
    method: DELETE
    params:
      id: string
- name: get_specific_request
  endpoint:
    path: /api/v1/image
    method: GET
    params:
      id: string
- name: delete_latest_version
  endpoint:
    path: /api/v1/registry/revert
    method: DELETE
    params:
      id: string
- name: revert_first_version
  endpoint:
    path: /api/v1/registry/revert
    method: DELETE
    params:
      id: string
      number: number
- name: vm_instance
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
- name: update_vm_instance
  endpoint:
    path: /api/v1/vm
    method: PUT
    data_selector: body
- name: terminate_vm_instance
  endpoint:
    path: /api/v1/vm
    method: DELETE
    data_selector: body
- name: list_vm_instances
  endpoint:
    path: /api/v1/vm
    method: GET
    data_selector: body
- name: node
  endpoint:
    path: /api/v1/node
    method: GET
    data_selector: body
- name: template
  endpoint:
    path: /api/v1/registry/vm
    method: GET
    data_selector: body
- name: revert_template
  endpoint:
    path: /api/v1/registry/revert
    method: DELETE
    data_selector: status
    params:
      id: string
      tag: Latest
      version: Latest
- name: distribute_template
  endpoint:
    path: /api/v1/registry/vm/distribute
    method: POST
    data_selector: body
    params:
      template_id: string
- name: get_distribution_status
  endpoint:
    path: /api/v1/registry/vm/distribute
    method: GET
    data_selector: body
    params:
      id: string
- name: vm_instance
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
    params: {}
- name: update_instance
  endpoint:
    path: /api/v1/vm
    method: PUT
    data_selector: body
    params: {}
- name: terminate_instance
  endpoint:
    path: /api/v1/vm
    method: DELETE
    data_selector: body
    params: {}
- name: list_vm_instances
  endpoint:
    path: /api/v1/vm
    method: GET
    data_selector: body
    params: {}
- name: node
  endpoint:
    path: /api/v1/node
    method: GET
    data_selector: body
    params: {}
- name: template
  endpoint:
    path: /api/v1/registry/vm
    method: GET
    data_selector: body
    params: {}
- name: save_template_image
  endpoint:
    path: /api/v1/image
    method: POST
    data_selector: body
- name: list_save_template_image_requests
  endpoint:
    path: /api/v1/image
    method: GET
    data_selector: body
- name: create_group
  endpoint:
    path: /api/v1/group
    method: POST
    data_selector: body
- name: list_groups
  endpoint:
    path: /api/v1/group
    method: GET
    data_selector: body
- name: update_group
  endpoint:
    path: /api/v1/group
    method: PUT
    data_selector: body
- name: delete_group
  endpoint:
    path: /api/v1/group
    method: DELETE
    data_selector: body
- name: add_nodes_to_group
  endpoint:
    path: /api/v1/node/group
    method: POST
    data_selector: body
- name: remove_nodes_from_group
  endpoint:
    path: /api/v1/node/group
    method: DELETE
    data_selector: body
- name: list_usb_devices
  endpoint:
    path: /api/v1/usb
    method: GET
    data_selector: body
- name: controller
  endpoint:
    path: /downloads/ankacontroller-registry-mac-latest
    method: GET
- name: status
  endpoint:
    path: /api/v1/status
    method: GET
- name: registry
  endpoint:
    path: /registry
    method: GET
    data_selector: repositories
- name: instances
  endpoint:
    path: /instances
    method: GET
    data_selector: instances
- name: controller
  endpoint:
    path: /
    method: GET
    data_selector: controller_info
- name: registry
  endpoint:
    path: /registry
    method: GET
    data_selector: registry_info
- name: usb_devices
  endpoint:
    path: /api/v1/usb
    method: GET
    data_selector: body
- name: vm
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
- name: command_reference
  endpoint:
    path: /docs/anka-build-cloud/virtualization-cli/command-reference/
    method: GET
- name: vm_lib_dir
  endpoint:
    path: /Users/nathanpierce/Library/Application Support/Veertu/Anka/vm_lib/
    method: GET
    data_selector: records
- name: state_lib_dir
  endpoint:
    path: /Users/nathanpierce/Library/Application Support/Veertu/Anka/state_lib/
    method: GET
    data_selector: records
- name: img_lib_dir
  endpoint:
    path: /Users/nathanpierce/Library/Application Support/Veertu/Anka/img_lib/
    method: GET
    data_selector: records
- name: log_dir
  endpoint:
    path: /Users/nathanpierce/Library/Logs/Anka/
    method: GET
    data_selector: records
- name: sierravm
  endpoint:
    path: /services/data/vXX.X/sobjects/VM
    method: GET
    data_selector: records
- name: VM
  endpoint:
    path: /view
    method: GET
    data_selector: vm_display
    params: {}
- name: attach
  endpoint:
    path: /attach
    method: GET
    data_selector: options
- name: clone
  endpoint:
    path: /clone
    method: GET
    data_selector: options
- name: config
  endpoint:
    path: /config
    method: GET
    data_selector: options
- name: create
  endpoint:
    path: /create
    method: GET
    data_selector: options
- name: delete
  endpoint:
    path: /delete
    method: GET
    data_selector: options
- name: describe
  endpoint:
    path: /describe
    method: GET
    data_selector: options
- name: detach
  endpoint:
    path: /detach
    method: GET
    data_selector: options
- name: license
  endpoint:
    path: /license
    method: GET
    data_selector: options
- name: list
  endpoint:
    path: /list
    method: GET
    data_selector: options
- name: modify
  endpoint:
    path: /modify
    method: GET
    data_selector: options
- name: modify
  endpoint:
    path: /modify
    method: GET
    data_selector: commands
    params: {}
- name: registry
  endpoint:
    path: /registry
    method: GET
    data_selector: commands
    params: {}
- name: usb
  endpoint:
    path: /usb
    method: GET
    data_selector: commands
    params: {}
- name: controller
  endpoint:
    path: /controller
    method: GET
- name: registry
  endpoint:
    path: /registry
    method: GET
- name: Anka Controller Docker container
  endpoint:
    path: /anka-controller
    method: GET
    data_selector: logs
    params: {}
- name: Anka Registry Docker container
  endpoint:
    path: /anka-registry
    method: GET
    data_selector: logs
    params: {}
- name: Anka Controller Deb package
  endpoint:
    path: /anka-controller-deb
    method: GET
    data_selector: logs
    params: {}
- name: Anka Registry Deb package
  endpoint:
    path: /anka-registry-deb
    method: GET
    data_selector: logs
    params: {}
- name: Anka Controller
  endpoint:
    path: /docs/anka-build-cloud/controller-and-registry/orientation/mac/
    method: GET
- name: Anka Registry
  endpoint:
    path: /docs/anka-build-cloud/controller-and-registry/
    method: GET
- name: list_vms
  endpoint:
    path: /registry/v2/vm
    method: GET
    data_selector: body
    params: {}
- name: list_vms
  endpoint:
    path: /registry/v2/vm
    method: GET
    data_selector: body
- name: delete_vm
  endpoint:
    path: /registry/vm
    method: DELETE
    data_selector: status
    params:
      id: string
- name: get_vm_configuration
  endpoint:
    path: /registry/vm/info
    method: GET
    data_selector: body
    params:
      id: string
      tag: string
      version: int
- name: revert_vm
  endpoint:
    path: /registry/revert
    method: DELETE
    data_selector: status
    params:
      id: string
      tag: string
      version: int
- name: controller
  endpoint:
    path: /usr/local/bin/anka-controllerd
    method: GET
    data_selector: version
    params: {}
- name: Deb Pkg logs
  endpoint:
    path: /docs/anka-build-cloud/controller-and-registry/logs/controller-registy-deb-pkg-/
    method: GET
- name: Linux logs
  endpoint:
    path: /docs/anka-build-cloud/controller-and-registry/logs/linuxlogs/
    method: GET
- name: Mac logs
  endpoint:
    path: /docs/anka-build-cloud/controller-and-registry/logs/maclogs/
    method: GET
- name: registry_logs
  endpoint:
    path: /var/log/anka-registry
    method: GET
- name: controller_logs
  endpoint:
    path: /var/log/anka-controller
    method: GET
- name: create_vm
  endpoint:
    path: /create-vm
    method: POST
    data_selector: vm_creation
    params:
      ram_size: 4G
      cpu_count: 2
      disk_size: 80G
      app: /Applications/Install macOS High Sierra.app
- name: vm
  endpoint:
    path: /vms
    method: GET
    data_selector: vm_list
- name: anka_runner
  endpoint:
    path: /ci/runners
    method: POST
    data_selector: runner
    params:
      registration-token: '**'
      ssh-user: VM_USER
      ssh-password: VM_PASSWORD
      anka-controller-address: http://ANKA_CLOUD_ADDRESS
      anka-image-id: IMAGE_ID
      name: my-anka-runner
- name: Anka Cloud
  endpoint:
    path: /manage-nodes-and-clouds/configure-clouds
    method: POST
    data_selector: clouds
- name: createDynamicAnkaNode
  endpoint:
    path: /createDynamicAnkaNode
    method: POST
    data_selector: result
    params:
      masterVmId: e1173284-39df-458c-b161-a54123409280
- name: TeamCity Plugin
  endpoint:
    path: /teamcity/plugin
    method: GET
    data_selector: records
- name: Jenkins Plugin
  endpoint:
    path: /jenkins/plugin
    method: GET
    data_selector: records
- name: Anka VM GitHub Action
  endpoint:
    path: /github/action
    method: GET
    data_selector: records
- name: Controller & Registry (Mac)
  endpoint:
    path: /controller/registry/mac
    method: GET
    data_selector: records
- name: Controller & Registry (Linux)
  endpoint:
    path: /controller/registry/linux
    method: GET
    data_selector: records
- name: Virtualization CLI
  endpoint:
    path: /virtualization/cli
    method: GET
    data_selector: records
- name: Packer Plugin
  endpoint:
    path: /packer/plugin
    method: GET
    data_selector: records
- name: GitLab Runner
  endpoint:
    path: /gitlab/runner
    method: GET
    data_selector: records
- name: controller_registry_mac
  endpoint:
    path: /controller/registry/mac
    method: GET
    data_selector: records
- name: jenkins_plugin
  endpoint:
    path: /jenkins/plugin
    method: GET
    data_selector: records
- name: teamcity_plugin
  endpoint:
    path: /teamcity/plugin
    method: GET
    data_selector: records
- name: create_vm
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
- name: show_vm
  endpoint:
    path: /api/v1/vm
    method: POST
    data_selector: body
notes:
- The server will return the status `FAIL` if the node does not exist.
- Run these against IP:Port of the Controller.
- To remove a Node from the cluster, execute `ankacluster disjoin` on the Node.
- Assuming you haven't changed the default port configuration, your Registry is serving
  requests on port 8089.
- While it's possible to run Docker on mac, it's not recommended. An Anka Controller
  & Registry package exists.
- We currently only support Docker within Nested Virtualization
- While it's possible to run Docker on mac, it's not recommended.
- If you're running these containers on mac, you need to also change etcd's local
  volume destination from `/var/etcd-data` to a writable location on your mac.
- The VM creation should take around 30 minutes.
- Anka Controller is serving web UI and REST API on port 80.
- Anka Registry is serving REST API on port 8089.
- Requires Enterprise or higher license
- Anka VMs are created with the default user `anka` and a password of `admin`.
- Every VM after the start/resume gets an IP address assigned by the internal DHCP
  server in range 192.168.64.2 - 192.168.64.254.
- Infrastructure as code (IaC) tools can be overwhelming when you first start looking
  into them.
- The default VM username is 'anka'
- The default VM password is 'admin'
- Uses OAuth2 with refresh token — requires setup of connected app in api
- Be aware of the user you're executing Anka CLI commands as. If you create Templates
  as root, they won't be available to other users on the system and vice versa.
- If you're running these commands over SSH, and not in an active GUI session, enable
  automatic login for the current user.
- It's very important that when you suspend from a started state that the VM has fully
  booted and logged into a user. If you don't, the VM will fail to start.
- Don't use the System Preference installer to update macOS inside Anka VM. Use the
  softwareupdate -Ri command line tool to upgrade macOS inside Anka VM.
- Currently, only a single directory can be specified.
- The anka run command doesn't source .profile or .bash_profile.
- You can set the resolution of the Viewer using `sudo anka modify 10.15.4 set display
  -r 1200x800`
- We follow semantic versioning; minor and major version increases can have significant
  changes.
- Uninstall doesn't remove the license. To remove license execute `sudo anka license
  remove` before uninstalling.
- Methods to setup authorization within your Controller & Registry.
- Default setup installs controller and registry together.
- All the default port and other configuration settings can be modified.
- Anka controller is a server that usually runs as a daemon and errors are usually
  written to a log.
- The service runs as root
- Anka Controller listens on port 80
- Anka Registry is listening on port 8089
- Registry data is stored at /Library/Application Support/Veertu/Anka/registry
- Prepare high availability macOS machines before connecting to the Anka Build Cloud
  Controller.
- Ensure that the machine has high availability by turning off sleep and several other
  default features that would cause the machine to become unavailable.
- Anka Build Cloud Controller should be configured and running before your Anka Node
  can join
- Your Node should be licensed
- Your Node should be prepared for high availability
- 'Data will be written to: /var/anka'
- 'Logs will be located at: /var/log/anka-registry'
- 'Anka Registry for Mac binary is installed at: /Library/Application Support/Veertu/Anka/bin/ankaregd'
- 'Launchd daemon: /Library/LaunchDaemons/com.veertu.anka.registry.plist'
- Configuration for this package is done by altering the Launcd daemon xml file at
  /Library/LaunchDaemons/com.veertu.anka.registry.plist
- 'Data will be saved at: /Library/Application Support/Veertu/Anka/registry'
- 'Logs: /Library/Logs/Veertu/AnkaController'
- This is a new API introduced in version 1.7.0
- Old path /registry/vm still works for backward compatibility.
- Starting from Controller release version 1.0.12, logs will be available for download
  from the Controller Management portal for error scenarios during VM provisioning.
- Event logging requires a Enterprise Plus license and will show under the Controller's
  Logs section after the first instance is created.
- Must pass this for authentication to work
- Advanced security features are currently only available for our Enterprise Tier
  licenses.
- Root Token authentication requires setup
- This guide requires an Anka Enterprise (or higher) license.
- 'Ensure that the certificate has Signature Algorithm: sha256WithRSAEncryption'
- If you previously joined your Nodes to the Controller, you'll want to `sudo ankacluster
  disjoin` on each before proceeding.
- 'You should see output similar to the following: Testing connection to Controller...:
  OK'
- Until you have a Node joined to the Controller, it won't see your Enterprise license
  and won't enable authentication.
- Troubleshooting guides for common issues
- VM Instances can be stuck in scheduling state due to multiple reasons including
  inactive nodes, local VMs running, registry connection issues, or insufficient disk
  space.
- 'When Jenkins starts a job using the Anka plugin, a lot of times you will see this
  message: *‘Jenkins’ doesn’t have label ‘MyLabel’* This is just the way Jenkins says
  it doesn''t have available nodes with this label at the moment.'
- Jenkins uses a library to handle `master <> agent` communication.
- If the Java versions on the Jenkins host and the VM does not match, install the
  correct version of Java on the VM.
- Anka controller and registry services can run with linux, using docker containers.
- Logs are available via the controller dashboard, docker logs and via directories
  in correspondence with anka services.
- Generally, log files are created for each vm upon vm start.
- Anka Build Cloud license tiers.
- Anka Flow is only supported on MacBook models and iMac.
- By default 'anka create' creates macOS VM with administrative user - anka and password
  - admin.
- VMs created are in suspended mode to enable fast boot/Instant Start.
- Don't use the System Preference installer to update macOS inside Anka VM. Use the
  `softwareupdate -Ri` command line tool to upgrade macOS inside Anka VM.
- VM isolation enables multiple environments simultaneously on the same host.
- All information stored on disk images is also encrypted on the fly.
- After running the installer package, `anka` is found at `/usr/local/bin/anka`.
- For major Anka releases, it may be required to upgrade guest addons in existing
  Anka VMs.
- Every policy has to have at least one administrator user.
- Initial policy has some predefined minimal set of rules to allow core Anka logic.
- The user can still build custom network topology, e.g. connect personal laptop with
  patch cord, and perform uncontrollable (from the perspective of corporate network)
  data transfers.
- OTFE is not turned on by default with `anka modify VM set policy` command.
- Currently aes-ecb encryption algorithm is supported.
- The Anka Buildkite plugin works differently than our other plugins. It will not
  start VM instances using your Anka Build Cloud Controller and instead connect directly
  to an unused Node agent to execute the VM setup commands.
- If the runner is on an AWS instance you will need to allow the AWS instance public
  IP in its own inbound rules.
- The VMs become deleted after every job finishes.
- Supports automated VM Tag creation after your jobs run.
- The cache build should have a job or pipeline of its own.
- 'How often should I cache? : The answer depends on the VM size after you prepare
  it and also the density of your builds.'
- The TeamCity plugin requires a VM with Java, SSH Remote Login, port-forwarding,
  and TeamCity.
- It's a good idea to set the Server URL to your TeamCity address and port (including
  http[s]://).
- There is no need to upgrade Anka VM created with 2.0 version to version 2.1.
- Shared folder is not supported for Catalina Anka VMs. We are waiting for Fuse libraries
  to be updated for Catalina.
- This release requires upgrade of Anka package on all of your nodes, controller,
  registry and all plugins.
- This release requires upgrade of all existing 1.4.X VM templates. Use anka start
  -u {template}/VMUUID command.
- Version 1.19 of Jenkins Plugin is not fully compatible with older versions of controller
  1.0.14 or 1.0.14.1. If you upgrade your plugin to version 1.19, you will need to
  recreate your Anka Cloud configuration in Jenkins.
- Https registries have to be re-added in 2.0.
- Trial license for Anka products is valid for 30 days from the date of trial registration.
- Anka uses standard http_proxy and https_proxy env variables.
errors:
- 'REQUEST_LIMIT_EXCEEDED: Throttle API calls or reduce frequency'
- 'QUERY_TIMEOUT: Break down filters or add selectivity'
- 'FAIL: Node does not exist'
- 'FAIL: Template does not exist'
- '401 Unauthorized: Recheck OAuth scopes or token expiration'
- 125 on timeout
- 'Could not build tls configuration: open /whwhwhw/path: no such file or directory'
- '401 Authentication Required: The authentication module is working.'
- VM Instance is stuck at scheduling state
- Jenkins doesn't start VMs
- Invalid RAM size specified.
- Insufficient disk space for VM creation.
- If you are not able to upgrade the guest add-ons tool using the `anka start -u {template}`
  command, then you have a very old version of guest addon tools on your VM.
- Only administrators can delete the VM policy.
- 128 bit encryption is more than enough to protect VM from unsolicited access/modifications,
  but for some applications aes-ecb-256 could be needed.
- 'Timeout: Stops waiting for the result of the Tag -> Registry push after x minutes.'
- License is removed. To activate with the same activation key on another machine,
  contact support@veertu.com with your activation key and fulfillment ID.
auth_info:
  mentioned_objects:
  - certificate based authentication
  - Root Token Authentication
  - Certificate Authentication
  - OpenId (SSO) Authentication
client:
  base_url: http://anka.controller.net
  auth:
    type: oauth2
source_metadata: null
