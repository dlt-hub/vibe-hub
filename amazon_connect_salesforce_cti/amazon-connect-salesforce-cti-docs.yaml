resources:
- name: sfInvokeAPI
  endpoint:
    path: /services/sfInvokeAPI
    method: POST
- name: query
  endpoint:
    path: /services/data/vXX.X/sobjects/Contact
    method: GET
    data_selector: sf_records
    params:
      sf_operation: query
      query: select Id from Contact where Phone LIKE '%number%'
- name: queryOne
  endpoint:
    path: /services/data/vXX.X/sobjects/Contact
    method: GET
    data_selector: Id
    params:
      sf_operation: queryOne
      query: select Id from Contact where Phone LIKE '%number%'
- name: createChatterPost
  endpoint:
    path: /services/data/vXX.X/chatter/feed-items
    method: POST
    data_selector: Id
    params:
      sf_operation: createChatterPost
      sf_feedElementType: ''
      sf_subjectId: ''
      sf_messageType: ''
      sf_message: I had a problem during the call. My contact id is `contactId`.
- name: createChatterComment
  endpoint:
    path: /services/data/vXX.X/chatter/feed-elements
    method: POST
    data_selector: Id
    params:
      sf_operation: createChatterComment
      sf_feedElementId: ''
      sf_commentType: ''
      sf_commentMessage: Please help me with case `caseId`.
- name: search
  endpoint:
    path: /services/data/vXX.X/search
    method: GET
    data_selector: sf_records
    params:
      sf_operation: search
      q: ''
      sf_fields: ''
      sf_object: ''
      where: ''
      overallLimit: ''
- name: searchOne
  endpoint:
    path: /services/data/vXX.X/search
    method: GET
    data_selector: Id
    params:
      sf_operation: searchOne
      q: ''
      sf_fields: ''
      sf_object: ''
      where: ''
- name: sfExecuteAwsService
  endpoint:
    path: /2015-03-31/functions/{insert lambda function name (copied above)}/invocations
    method: POST
- name: AC Guided Setup
  endpoint:
    method: GET
- name: AC Lightning Adapter
  endpoint:
    path: /services/data/vXX.X/sobjects/ACLightningAdapter
    method: GET
- name: sfInvokeAPI
  endpoint:
    path: /path/to/sfInvokeAPI
    method: POST
    data_selector: response
    params: {}
- name: CCP Config
  endpoint:
    path: /services/data/vXX.X/sobjects/CCPConfig
    method: GET
    data_selector: records
- name: ContactChannelAnalytics
  endpoint:
    path: /services/data/vXX.X/sobjects/ContactChannelAnalytics
    method: GET
    data_selector: records
- name: CTI Attributes
  endpoint:
    path: /CTI/Attributes
    method: GET
    data_selector: attributes
    params: {}
- name: CTI Flow
  endpoint:
    path: /services/data/vXX.X/sobjects/CTIFlow
    method: POST
    data_selector: actions
    params: {}
- name: Presence Sync Rules
  endpoint:
    path: /presence/sync/rules
    method: GET
    data_selector: rules
    params: {}
- name: presence_sync_rule
  endpoint:
    path: /services/data/vXX.X/sobjects/PresenceSyncRule
    method: POST
    data_selector: records
    params: {}
- name: SetAgentStatusOnSessionEnd
  endpoint:
    path: /set-agent-status-on-session-end
    method: POST
    data_selector: statusChangeResponse
    params: {}
- name: Contact Channel Analytics
  endpoint:
    path: /amazon-connect/salesforce-cti/docs/lightning/salesforce-lambdas/04-contact-channel-analytics
    method: GET
- name: Postcall Contact Lens Import
  endpoint:
    path: /amazon-connect/salesforce-cti/docs/lightning/salesforce-lambdas/06-postcall-contact-lens-import
    method: GET
- name: Recording Controls
  endpoint:
    path: /recording-controls
    method: GET
- name: chat_widget
  endpoint:
    path: /chat-widget
    method: GET
    data_selector: widgetData
    params: {}
- name: AC_ChatWidget
  endpoint:
    path: /services/data/vXX.X/sobjects/AC_ChatWidget
    method: GET
    data_selector: records
    params: {}
- name: amazon_q_feature
  endpoint:
    path: /services/data/vXX.X/amazon_q_feature
    method: POST
    data_selector: feature
    params:
      feature_name: FEATURE_AMAZONQ_PANEL
      value:
        Enabled: true
        IgnorePermissionSet: true
- name: VDIPlatform
  endpoint:
    path: /path/to/vdi/platform
    method: POST
    data_selector: records
    params:
      AC Feature Name: VDIPlatform
      Value: Name:CITRIX
- name: AC CTI Adapter
  endpoint:
    path: /services/data/vXX.X/sobjects/AC_CTI_Adapter
    method: GET
    data_selector: records
    params: {}
- name: AC Contact Trace Records
  endpoint:
    path: /some/path/to/contact/trace/records
    method: GET
    data_selector: records
- name: AC Contact Channel Analytics
  endpoint:
    path: /some/path/to/contact/channel/analytics
    method: GET
    data_selector: records
- name: AC_LightningMiniAdapter
  endpoint:
    path: /apex/AC_LightningMiniAdapter
    method: GET
- name: sfInvokeAPI
  endpoint:
    path: /services/apexrest/sfInvokeAPI
    method: POST
    data_selector: response
    params: {}
- name: query
  endpoint:
    path: /services/data/vXX.X/query
    method: POST
    data_selector: sf_records
    params:
      sf_operation: query
      query: select Id from Contact where Phone LIKE '%number%'
- name: queryOne
  endpoint:
    path: /services/data/vXX.X/queryOne
    method: POST
    data_selector: Id
    params:
      sf_operation: queryOne
      query: select Id from Contact where Phone LIKE '%number%'
- name: createChatterPost
  endpoint:
    path: /services/data/vXX.X/chatter/feed-items
    method: POST
    data_selector: Id
    params:
      sf_operation: createChatterPost
- name: createChatterComment
  endpoint:
    path: /services/data/vXX.X/chatter/feed-elements/{sf_feedElementId}/comments
    method: POST
    data_selector: Id
    params:
      sf_operation: createChatterComment
- name: search
  endpoint:
    path: /services/data/vXX.X/search
    method: GET
    data_selector: sf_records
    params:
      sf_operation: search
- name: searchOne
  endpoint:
    path: /services/data/vXX.X/searchOne
    method: GET
    data_selector: Id
    params:
      sf_operation: searchOne
- name: sfIntervalQueue
  endpoint:
    path: /services/data/vXX.X/sobjects/sfIntervalQueue
    method: GET
    data_selector: records
    params:
      incremental: updated_at
- name: sfIntervalAgent
  endpoint:
    path: /services/data/vXX.X/sobjects/sfIntervalAgent
    method: GET
    data_selector: records
    params: {}
- name: AC Queue Metrics
  endpoint:
    path: /services/data/vXX.X/sobjects/AC_Queue_Metrics
    method: GET
    data_selector: records
- name: AC Real Time Queue Metrics
  endpoint:
    path: /services/data/vXX.X/sobjects/AC_Real_Time_Queue_Metrics
    method: GET
    data_selector: records
- name: Contact Channel Analytics
  endpoint:
    path: /amazon-connect-salesforce-cti/docs/lightning/salesforce-lambdas/04-contact-channel-analytics
    method: GET
    data_selector: records
    params: {}
- name: recording_transcription
  endpoint:
    path: /services/data/vXX.X/recordingTranscription
    method: POST
    data_selector: transcriptions
    params:
      postcallTranscribeEnabled: 'true'
      postcallTranscribeLanguage: en-US
- name: ai_driven_contact_analysis
  endpoint:
    path: /services/data/vXX.X/aiDrivenContactAnalysis
    method: POST
    data_selector: analysis
    params:
      postcallTranscribeComprehendAnalysis: snt,dl,kw,syn
- name: Contact Trace Record
  endpoint:
    path: /contact-trace-records
    method: GET
    data_selector: records
- name: Contact Lens Import
  endpoint:
    path: /contact-lens/import
    method: POST
    data_selector: ImportData
    params:
      contactLensImportEnabled: 'true'
      postcallRecordingImportEnabled: 'true'
      postcallRedactedRecordingImportEnabled: 'true'
- name: Get Agent Configuration
  endpoint:
    path: /get-agent-configuration
    method: GET
- name: Get Agent Dialable Countries
  endpoint:
    path: /get-agent-dialable-countries
    method: GET
- name: Create Task Contact
  endpoint:
    path: /create-task-contact
    method: POST
- name: Get Contact Attribute
  endpoint:
    path: /get-contact-attribute
    method: GET
- name: Is Voice Contact?
  endpoint:
    path: /is-voice-contact
    method: GET
- name: Is Chat Contact?
  endpoint:
    path: /is-chat-contact
    method: GET
- name: Is Task Contact?
  endpoint:
    path: /is-task-contact
    method: GET
- name: Is Contact Inbound?
  endpoint:
    path: /is-contact-inbound
    method: GET
- name: Is Contact Transfer?
  endpoint:
    path: /is-contact-transfer
    method: GET
- name: Is Callback?
  endpoint:
    path: /is-callback
    method: GET
- name: Get Contact Properties
  endpoint:
    path: /get-contact-properties
    method: GET
- name: Get Customer Phone Number
  endpoint:
    path: /get-customer-phone-number
    method: GET
- name: Get Contact Interaction Metadata
  endpoint:
    path: /get-contact-interaction-metadata
    method: GET
- name: Pop Task Contact's Reference Urls
  endpoint:
    path: /pop-task-contacts-reference-urls
    method: GET
- name: Query value
  endpoint:
    path: /query-value
    method: POST
- name: Get Salesforce Lead Id
  endpoint:
    path: /get-salesforce-lead-id
    method: GET
- name: Get Salesforce Contact Id
  endpoint:
    path: /get-salesforce-contact-id
    method: GET
- name: Retrieve Salesforce Record
  endpoint:
    path: /retrieve-salesforce-record
    method: GET
- name: Extract Value
  endpoint:
    path: /extract-value
    method: GET
- name: Open Salesforce Primary Tab
  endpoint:
    path: /open-salesforce-primary-tab
    method: GET
- name: Open Salesforce Sub Tab
  endpoint:
    path: /open-salesforce-sub-tab
    method: GET
- name: Get Focused Primary Tab Object Id
  endpoint:
    path: /get-focused-primary-tab-object-id
    method: GET
- name: Get Focused Subtab Object Id
  endpoint:
    path: /get-focused-subtab-object-id
    method: GET
- name: Get CCP Logs
  endpoint:
    path: /get-ccp-logs
    method: GET
- name: Clear All Properties
  endpoint:
    path: /clear-all-properties
    method: DELETE
- name: Unset Property
  endpoint:
    path: /unset-property
    method: DELETE
- name: Start Recording
  endpoint:
    path: /start-recording
    method: POST
- name: Stop Recording
  endpoint:
    path: /stop-recording
    method: POST
- name: Update Contact Attributes
  endpoint:
    path: /update-contact-attributes
    method: POST
- name: Get Payload
  endpoint:
    path: /get-payload
    method: GET
- name: Send Data to CCP Overlay
  endpoint:
    path: /send-data-to-ccp-overlay
    method: POST
- name: Leave a Voicemail
  endpoint:
    path: /leave-a-voicemail
    method: POST
- name: Destroy Agent Connection to Live Contact
  endpoint:
    path: /destroy-agent-connection-to-live-contact
    method: DELETE
- name: Clear Contact
  endpoint:
    path: /clear-contact
    method: DELETE
notes:
- Naming of the Lambda function will vary based on template data, but sfInvokeAPI
  will always be a part of the name.
- Google Chrome third-party cookies support introduced in v5.21
- Salesforce summer release '23 blocks Username-Password Flow by default
- Salesforce Enhanced Domains changes require migration to new domains
- Spring '22 release may cause install or update failures for versions before 5.18
- WebRTC Plan-B Deprecation does not affect current users
- Confirm the application was installed for admins only
- Known Issue in v5.22 - Playback of Connect call recordings on Lightning Task or
  Case.
- If you wish to use the v5.22 lambdas, you will need to upgrade your CTI Adapter
  to v5.22.
- Contact Control Panel (CCP) Audio Device settings option.
- Custom Ringtone for chat.
- Salesforce built-in Cross Site Request Forgery (CSRF) protection is enabled for
  Visualforce pages in the CTI Adapter package.
- Decision blocks no longer requires both sockets to be connected.
- Click to Dial stopped working after first use until the agent refreshed the page.
- Error that prevented Contact Lens app resources from being hosted on a different
  domain than the Salesforce instance.
- Error that prevented Contact Lens app from displaying intermittently when Transcribe
  was enabled.
- Changed the logic for the IsContactTransfer CTI Flow Block which always returned
  true.
- Medialess popout not closing after Salesforce tabs are closed.
- Login window did not close automatically after logging into Connect.
- Unable to upgrade the package if the Case or Contact object contained encrypted
  fields.
- Salesforce org with Lightning experience
- My Domain configured and deployed to users
- Ensure the application is installed for admins only to prevent standard users from
  invoking methods that call named credentials.
- Failure to set user passwords to never expire may lead to production outages.
- All users must be assigned the required permission set to access Salesforce metadata.
- The Amazon Connect CTI Adapter includes two Permission Sets, one for agents and
  one for managers.
- Uses OAuth2 with refresh token â€” requires setup of connected app in api
- Requires setup of Connected App in Salesforce.
- Validating the lambda functions requires the use of test events to simulate data
  coming into the function as it would in a typical deployment.
- The phone number must be in E.164 format.
- There is a bug with Salesforce that doesn't update a page layout when you upgrade
  a package.
- Certain picklists are missing picklist items when upgrading from a version of the
  package to a higher version.
- With the new Amazon Connect instance urls (`*.my.connect.aws`) you must put the
  full URL into the `Amazon Connect Instance` field in the AC CTI Adapter record for
  SSO to work.
- CTI Attributes provide the ability to reference and display contact attribute data
  within the Amazon Connect Contact Control Panel (CCP).
- Adding attributes does not import data directly into Salesforce.
- CTI Flows consist of actions that represent an API call to parts of Salesforce or
  Amazon Connect API.
- Presence Sync Rules require statuses in both Amazon Connect and Salesforce.
- The feature is not turned on by default.
- The static value for Salesforce Omni-Channel status is the Developer Name, not the
  Status Name.
- CTI adapter only have nine languages built within the package.
- Not all fields can be localized to different languages.
- This feature will popup a window to perform the logout functionality.
- This feature does not work with Salesforce Pop-Out utilities.
- A new Contact Channel Analytics record is created three minutes after the call with
  the recording URL.
- The record is updated with Contact Lens recording, transcript, and other metadata
  three minutes later.
- To access the recording, the user must have an active session with Amazon Connect.
- The Recording Controls panel is disabled by default. Enable it by adding FEATURE_RECORDING_PANEL
  feature flag with setting Enabled:true.
- If you have Recording Controls enabled and do not explicitly set a Named Credential
  on the CTI Adapter, it will assume AmazonConnectAPI by default.
- This feature does not support Build Your Own(LWR) and Salesforce Tabs + Visualforce
  template.
- If you want to setup chat widget for authorized user group only, you could change
  the settings to the guest profile to the authorized user profile.
- Salesforce users accessing Amazon Q in Salesforce must belong to either the AC_AmazonQ
  permission set, or the AC_Administrator permission set.
- Install Amazon Connect CTI Adapter version v5.16 or higher in your salesforce instance.
- Required AC CTI Adapter feature for all VDI Platforms
- A VDI Platform should be set only if the Medialess settings are disabled.
- If you want to set any VDI Platform, then disable Medialess from CTI Adapter.
- Uses AWS IAM credentials for authentication.
- AWS Access Key ID and AWS Secret Access Key can be shared between Replica and Source
  Regions.
- This feature is for agents using the native CCP window from Amazon Connect for your
  instance and opting not to use the CTI Adapter Embedded CCP for SoftPhone.
- sfInvokeAPI allows access to various Salesforce operations like create, update,
  delete, and query.
- Each CTI adapter release will only be able to support a subset of all of the metrics
  available as new metrics are continuously being added by Connect after CTI adapter
  releases have already been released to the public.
- When migrating from an older version of the CTI Adapter (At least earlier than v4.5),
  users may notice that ACSFCCP_HistoricalReportData is no longer being updated/populated.
- CTRs are available within your Amazon Connect instance for 24 months from the time
  when the associated contact was initiated.
- If you are expecting more than 1000 concurrent calls, you may have to increase the
  timeout for the `sfCTRTrigger` lambda.
- Make sure you set ContactLensImportEnabled to true during the deployment of Amazon
  Connect Salesforce Lambda application.
- Set the Prefix to Analysis/Voice/2020. Note that this might change as the date changes.
- To sync your Connect User status with your Omni-Channel agent status, you must configure
  Omni-Channel Presence Syncing.
- An Amazon Connect Instance configured for SAML authentication is required.
- Administrator permissions for your Salesforce Org are required.
- Uses SAML for authentication
- Enable High Velocity Sales features in Salesforce Org
errors:
- 'REQUEST_LIMIT_EXCEEDED: Throttle API calls or reduce frequency'
- 'QUERY_TIMEOUT: Break down filters or add selectivity'
- '401 Unauthorized: Recheck OAuth scopes or token expiration'
- Error 'refused to run the JavaScript URL because it violates the following Content
  Security Policy directive...'
- Error 'refused to frame' Visualforce page
- '401 Unauthorized: Recheck AWS IAM user permissions'
- '400 Bad Request: Check the parameters being passed.'
- '404 Not Found: Ensure the object type is correct.'
- '204 No Content: Indicates a successful update or delete operation.'
auth_info:
  mentioned_objects:
  - NamedCredential
  - Connected App
  - API User
client:
  base_url: https://lambda.{insert AWS region}.amazonaws.com/2015-03-31/functions/{insert
    lambda function name (copied above)}/invocations
  auth:
    type: AWS Signature Version 4
    client_id: '{Access Key ID}'
    client_secret: '{Secret Access Key}'
source_metadata: null
